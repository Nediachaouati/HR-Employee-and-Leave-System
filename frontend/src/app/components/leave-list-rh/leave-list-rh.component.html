<div class="container-fluid mt-5">
    <h2 class="mb-4">Leave Demands</h2>

  <table class="table table-striped table-bordered table-hover w-100" style="table-layout: auto;">
    <thead class="thead-dark">
      <tr>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Type</th>
        <th>Status</th>
        <th>Comments</th>
        <th>Approved By</th>
        <th>Created At</th>
        <th>Updated At</th>
        <th style="min-width: 250px;">Actions</th>
      </tr>
    </thead>

    <tbody>
      <ng-container *ngFor="let demand of demandes">
        <tr>
          <td>{{ demand.start_date | date:'yyyy-MM-dd' }}</td>
          <td>{{ demand.end_date | date:'yyyy-MM-dd' }}</td>
          <td>{{ demand.type }}</td>
          <td>
            <span 
              class="badge"
              [ngClass]="{
                'bg-warning text-dark': demand.status === 'En attente',
                'bg-danger': demand.status === 'Rejeté',
                'bg-success': demand.status === 'Approuvé'
              }">
              {{ demand.status }}
            </span>
          </td>
          <td>{{ demand.comments }}</td>
          <td>{{ demand.approvedById ? demand.approvedById : 'Not approved yet' }}</td>
          <td>{{ demand.created_at | date:'yyyy-MM-dd HH:mm' }}</td>
          <td>{{ demand.updated_at | date:'yyyy-MM-dd HH:mm' }}</td>
          <td>
            <div class="d-flex flex-wrap gap-1">
              <button class="btn btn-success btn-sm" (click)="updateStatus(demand.id, 'Approuvé')">Accept</button>
              <button class="btn btn-danger btn-sm" (click)="updateStatus(demand.id, 'Rejeté')">Decline</button>
              <button class="btn btn-info btn-sm" (click)="toggleDetails(demand.id)">
                {{ selectedDemandId === demand.id ? 'Hide Details' : 'Show More' }}
              </button>
            </div>
          </td>
        </tr>

        <!-- Row for the details -->
        <tr *ngIf="selectedDemandId === demand.id">
          <td colspan="9">
            <div class="p-3 bg-light border rounded">
              <h5>Demand Details:</h5>
              <p><strong>Start Date:</strong> {{ demand.start_date }}</p>
              <p><strong>End Date:</strong> {{ demand.end_date }}</p>
              <p><strong>Type:</strong> {{ demand.type }}</p>
              <p><strong>Status:</strong> {{ demand.status }}</p>
              <p><strong>Comments:</strong> {{ demand.comments }}</p>
              <p><strong>Approved By:</strong> {{ demand.approvedById || 'Not approved yet' }}</p>
              <p><strong>Created At:</strong> {{ demand.created_at }}</p>
              <p><strong>Updated At:</strong> {{ demand.updated_at }}</p>
              <button class="btn btn-success btn-sm" (click)="updateStatus(demand.id, 'Approuvé')">Accept</button>
              <button class="btn btn-danger btn-sm" (click)="updateStatus(demand.id, 'Rejeté')">Decline</button>
            </div>
          </td>
        </tr>

      </ng-container>
    </tbody>
  </table>
</div>
