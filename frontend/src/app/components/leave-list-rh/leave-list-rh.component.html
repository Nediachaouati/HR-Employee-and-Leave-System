<div class="container-fluid mt-5">
  <h2 class="mb-4 text-primary">Leave Demands</h2>

  <!-- Table with horizontal scrolling enabled -->
  <div class="table-responsive" style="overflow-x: auto;">
    <table class="table table-bordered table-hover w-100 shadow-sm rounded bg-white">
      <thead class="table-dark text-center">
        <tr>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Type</th>
          <th>Status</th>
          <th>Comments</th>
          <th>Approved By</th>
          <th>Created At</th>
          <th>Updated At</th>
          <th style="min-width: 250px;">Actions</th>
        </tr>
      </thead>

      <tbody class="align-middle text-center">
        <ng-container *ngFor="let demand of demandes">
          <tr>
            <td>{{ demand.start_date | date:'yyyy-MM-dd' }}</td>
            <td>{{ demand.end_date | date:'yyyy-MM-dd' }}</td>
            <td>{{ demand.type }}</td>
            <td>
              <span 
                class="badge px-3 py-2 fs-6"
                [ngClass]="{
                  'bg-warning text-dark': demand.status === 'En attente',
                  'bg-danger': demand.status === 'Rejeté',
                  'bg-success': demand.status === 'Approuvé'
                }">
                {{ demand.status }}
              </span>
            </td>
            <td>{{ demand.comments }}</td>
            <td>{{ demand.approvedById || 'Not approved yet' }}</td>
            <td>{{ demand.created_at | date:'yyyy-MM-dd HH:mm' }}</td>
            <td>{{ demand.updated_at | date:'yyyy-MM-dd HH:mm' }}</td>
            <td>
              <div class="d-flex flex-wrap gap-2 justify-content-center">
                <button class="btn btn-success btn-sm px-3" (click)="updateStatus(demand.id, 'Approuvé')">Accept</button>
                <button class="btn btn-danger btn-sm px-3" (click)="updateStatus(demand.id, 'Rejeté')">Decline</button>
                <button class="btn btn-info btn-sm px-3" (click)="toggleDetails(demand.id)">
                  {{ selectedDemandId === demand.id ? 'Hide Details' : 'Show More' }}
                </button>
              </div>
            </td>
          </tr>

          <!-- Row for the details -->
          <tr *ngIf="selectedDemandId === demand.id">
            <td colspan="9">
              <div class="p-3 bg-light border rounded">
                <h5 class="text-secondary">Demand Details:</h5>
                <div class="row">
                  <div class="col-md-4"><strong>Start Date:</strong> {{ demand.start_date }}</div>
                  <div class="col-md-4"><strong>End Date:</strong> {{ demand.end_date }}</div>
                  <div class="col-md-4"><strong>Type:</strong> {{ demand.type }}</div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-4"><strong>Status:</strong> {{ demand.status }}</div>
                  <div class="col-md-4"><strong>Approved By:</strong> {{ demand.approvedById || 'Not approved yet' }}</div>
                  <div class="col-md-4"><strong>Created At:</strong> {{ demand.created_at }}</div>
                </div>
                <div class="row mt-2">
                  <div class="col-md-8"><strong>Comments:</strong> {{ demand.comments }}</div>
                  <div class="col-md-4"><strong>Updated At:</strong> {{ demand.updated_at }}</div>
                </div>

                <div class="mt-3 d-flex gap-2">
                  <button class="btn btn-success btn-sm px-3" (click)="updateStatus(demand.id, 'Approuvé')">Accept</button>
                  <button class="btn btn-danger btn-sm px-3" (click)="updateStatus(demand.id, 'Rejeté')">Decline</button>
                </div>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
